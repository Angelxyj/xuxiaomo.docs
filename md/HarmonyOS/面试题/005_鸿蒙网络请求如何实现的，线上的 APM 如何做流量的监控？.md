# 005\_鸿蒙网络请求如何实现的，线上的 APM 如何做流量的监控？

- 鸿蒙网络请求的实现涉及到多个步骤，包括配置网络访问权限、设置访问模式、以及使用 Java 原生请求或第三方库进行网络访问。下面将详细解释这些步骤：

1. 配置网络访问权限：

- 在鸿蒙系统中，要访问网络，首先需要配置网络访问权限。这通常在 config.json 文件的 module 节点下完成。
- 添加网络访问权限的代码可能类似于： "reqPermissions": [{"name":"ohos.permission.INTERNET"}] 。这表示应用需要访问互联网的权限。

2. 设置访问模式：

- 鸿蒙系统的默认访问模式是 https。如果你的请求网址是 http 开头的，需要在 config.json 文件的 deviceConfig 下添加相应的设置。
- 例如，如果需要请求的网址是 http 链接，可能需要在 config.json 中添加类似以下的配置： "deviceConfig": {"defaultHttpPort": 80} 。

3. 使用 Java 原生请求进行网络访问：

- 由于鸿蒙系统支持 Java 开发，可以直接使用 Java 原生的 API 来进行网络访问。
- Java 的 url.openConnection() API 可以用来获取网络数据。你可以创建一个请求工具类，利用这个 API 发送 GET 或 POST 请求。
- GET 请求的数据会附在 URL 之后，以 ? 分割 URL 和传输数据，参数之间以 & 相连。而 POST 请求的参数不是放在 URL 字符串里面，而是放在 HTTP 请求的正文内，请求的参数被封装起来以流的形式发送给服务端。

4. 使用第三方库进行网络访问：

- 除了使用 Java 原生 API，还可以选择使用第三方库来进行网络请求，如 Retrofit 等。这些库通常提供了更强大、更灵活的网络访问功能，可以满足绝大部分开发者的需求。

- 鸿蒙网络请求的实现涉及到配置权限、设置访问模式、以及选择适当的网络请求方式。通过合理的配置和使用 API 或第三方库，开发者可以在鸿蒙系统中实现高效、稳定的网络请求功能。
- 鸿蒙系统线上的 APM（应用性能管理）做流量监控时，主要关注的是应用程序的网络通信数据。这些数据不仅包括了应用产生的数据请求，也包括了应用接收到的响应数据。流量监控的目的是确保应用程序的网络通信是高效的、安全的，并且能够提供最佳的用户体验。
- 下面是一个关于鸿蒙系统线上 APM 如何进行流量监控的详解：

1. 流量数据采集

- 首先，APM 系统需要能够捕获应用程序的网络通信数据。这通常通过以下几个方式实现：
  - 网络层拦截：在应用程序的网络请求发出之前或接收响应之后，APM 系统可以拦截这些请求和响
    应，从而获取到详细的数据。
  - 代理服务器：设置一个代理服务器来监听和记录所有通过网络传输的数据。
  - SDK 集成：通过集成 SDK 到应用程序中，可以收集到应用程序发出的网络请求和接收到的响应数
    据。

2. 数据分析和处理

- 收集到流量数据后，APM 系统需要对这些数据进行处理和分析，以提取出有用的信息。这包括：
  - 流量统计：统计应用程序发出的请求数量和接收到的响应数量。
  - 请求分析：分析请求的 URL、请求方法（GET、POST 等）、请求头、请求体等信息。
  - 响应分析：分析响应的状态码、响应头、响应体等信息。
  - 性能分析：分析请求和响应的延迟、带宽使用情况等性能指标。

3. 可视化展示

- 处理和分析完数据后，APM 系统需要将结果以直观的方式展示给开发者。这通常通过以下方式实现：
  - 仪表板：提供一个仪表板，展示关键的性能指标，如请求数量、延迟、错误率等。
  - 详细报告：提供详细的报告，包括每个请求的详细信息、性能分析、错误日志等。
  - 趋势分析：展示性能指标随时间变化的趋势，帮助开发者识别潜在的性能问题。

4. 报警和通知

- 当 APM 系统检测到异常情况或潜在的性能问题时，需要能够及时通知开发者。这通常通过以下方式实现：
  - 阈值报警：设置性能指标的阈值，当超过这些阈值时，系统自动发送报警通知。
  - 实时通知：对于严重的性能问题或错误，系统可以实时发送通知给开发者。
  - 报告和日志：提供详细的报告和日志，帮助开发者定位和解决问题。

5. 优化建议

- 除了监控和报警，APM 系统还可以提供优化建议，帮助开发者提高应用程序的网络通信性能。这些建议可能包括：
  - 优化请求和响应大小：减少不必要的数据传输，提高数据传输效率。
  - 优化请求频率：合理设置请求间隔，避免频繁的请求对服务器造成压力。
  - 选择最佳的通信协议：根据应用的需求选择合适的通信协议，如 HTTP/2、WebSocket 等。

总结

- 鸿蒙系统线上的 APM 通过采集、分析、展示流量数据，提供报警和通知，以及优化建议，帮助开发者有效地监控和管理应用程序的网络通信性能。这不仅可以提高应用程序的稳定性和用户体验，还可以帮助开发者及时发现和解决问题，提高开发效率。
